<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>welcome to my crib</title>
  <meta name="description" content="check out my cool stuff">
  <meta name="author" content="murfalo">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="murfalo">
  <meta property="og:description" content="check out my cool stuff">
  <meta property="og:url" content="https://murfalo.com">
  <meta property="og:image" content="https://murfalo.com/img/murfalo.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="murfalo">
  <meta name="twitter:description" content="check out my cool stuff">
  <meta name="twitter:image" content="https://murfalo.com/img/murfalo.png">

  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#18181b">

  <style>
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    ::selection {
      background: rgba(139, 92, 246, 0.35);
      color: #e4e4e7;
    }

    :root {
      --color-bg: #18181b;
      --color-text: #e4e4e7;
      --color-muted: #a1a1aa;
      --color-primary: #8b5cf6;
      --color-primary-glow: rgba(139, 92, 246, 0.4);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--color-bg);
      color: var(--color-text);
      min-height: 100dvh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
      user-select: none;
    }

    /* Noise texture overlay */
    .noise {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 2;
      opacity: 0.035;
    }

    /* Lava lamp canvas */
    .lava-canvas {
      position: fixed;
      inset: 0;
      z-index: 0;
      cursor: grab;
    }

    .lava-canvas:active {
      cursor: grabbing;
    }

    .container {
      text-align: center;
      padding: 2rem;
      animation: fadeIn 0.6s ease-out;
      position: relative;
      z-index: 1;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .avatar {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 0 24px var(--color-primary-glow);
      transition: box-shadow 0.3s ease, transform 0.3s ease;
    }

    .avatar:hover {
      box-shadow: 0 0 40px var(--color-primary-glow), 0 0 80px rgba(139, 92, 246, 0.15);
      transform: scale(1.03);
    }

    h1 {
      margin-top: 1.25rem;
      font-size: 2.5rem;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .bio {
      margin-top: 0.4rem;
      font-size: 1.1rem;
      color: var(--color-muted);
    }

    .cursor {
      display: inline-block;
      width: 2px;
      height: 1.1em;
      background: var(--color-primary);
      margin-left: 1px;
      vertical-align: text-bottom;
      animation: blink 0.6s step-end infinite;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    nav {
      margin-top: 1.75rem;
      display: flex;
      gap: 1.25rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    nav a {
      color: var(--color-muted);
      transition: color 0.2s ease, transform 0.2s ease;
      display: inline-flex;
    }

    nav a:hover {
      color: var(--color-primary);
      transform: translateY(-2px);
    }

    nav a svg {
      width: 26px;
      height: 26px;
      fill: currentColor;
    }

    .bubble-hint {
      position: fixed;
      bottom: 1.25rem;
      left: 0;
      right: 0;
      text-align: center;
      font-style: italic;
      font-size: 0.85rem;
      color: var(--color-muted);
      z-index: 3;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .bubble-hint.visible {
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <!-- Lava lamp canvas -->
  <canvas class="lava-canvas" id="lava"></canvas>

  <!-- Noise texture -->
  <svg class="noise" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
    <filter id="noiseFilter">
      <feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/>
    </filter>
    <rect width="100%" height="100%" filter="url(#noiseFilter)"/>
  </svg>

  <main class="container">
    <img class="avatar" src="img/murfalo.png" alt="murfalo — dog in purple hoodie and sunglasses" width="160" height="160" draggable="false">
    <h1>murfalo</h1>
    <p class="bio">check out my <span id="typed"></span><span class="cursor"></span></p>

    <nav aria-label="Social links">
      <!-- Email -->
      <a href="mailto:howdy@murfalo.com" aria-label="Email">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 2-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z"/></svg>
      </a>

      <!-- GitHub -->
      <a href="https://github.com/murfalo" rel="me" aria-label="GitHub">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.009-.866-.013-1.7-2.782.604-3.369-1.341-3.369-1.341-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.337-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0 1 12 6.836a9.59 9.59 0 0 1 2.504.337c1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.163 22 16.418 22 12c0-5.523-4.477-10-10-10z"/></svg>
      </a>

      <!-- Google Scholar -->
      <a href="https://scholar.google.com/citations?user=zC_z7igAAAAJ" aria-label="Google Scholar">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 24a7 7 0 1 1 0-14 7 7 0 0 1 0 14zm0-2a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"/><path d="m21.5 10-9.5-8-9.5 8h5.5v4h2v-4z"/></svg>
      </a>

      <!-- LinkedIn -->
      <a href="https://www.linkedin.com/in/murfalo" rel="me" aria-label="LinkedIn">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
      </a>

      <!-- Twitter / X -->
      <a href="https://twitter.com/mvrfalo" rel="me" aria-label="Twitter">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
      </a>

      <!-- Bluesky -->
      <a href="https://bsky.app/profile/murfalo.bsky.social" rel="me" aria-label="Bluesky">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.25c2.095 2.633 4.35 7.98 4.35 7.98s.456 7.332-4.35 4.613c-4.806 2.719-4.35-4.613-4.35-4.613S9.905 4.883 12 2.25zm-4.35 15.7c1.467.88 3.127.37 4.35-.664 1.223 1.034 2.883 1.544 4.35.665 1.963-1.178 2.152-3.291 2.003-4.214.62.327 1.62.532 2.397-.108 1.12-.923.65-2.6-.75-3.629-1.64-1.207-3.042-.635-3.042-.635s.404-4.329-1.258-6.607C14.198.966 12.877.25 12 .25s-2.198.716-3.7 2.508c-1.662 2.278-1.258 6.607-1.258 6.607s-1.402-.572-3.042.635c-1.4 1.03-1.87 2.706-.75 3.63.777.64 1.777.434 2.397.107-.149.923.04 3.036 2.003 4.214z"/></svg>
      </a>

      <!-- Instagram -->
      <a href="https://instagram.com/mvrfalo" rel="me" aria-label="Instagram">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 0 0 0-12.324zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm6.406-11.845a1.44 1.44 0 1 0 0 2.881 1.44 1.44 0 0 0 0-2.881z"/></svg>
      </a>
    </nav>
  </main>
  <p class="bubble-hint" id="bubble-hint">oh no! you popped my bubble</p>

  <script>
    // --- Typewriter ---
    (() => {
      const words = [
        "molecules", "proteins", "RNA", "simulations", "amino acids",
        "force fields", "PDBs", "molecular dynamics", "nucleotides",
        "Terraria mods", "repos", "commits", "side quests", "loot",
        "inventory", "patch notes", "sludge", "slop",
        "cool stuff", "dog pics", "drip", "hoodie collection", "sunglasses",
        "crib", "vibes", "hot takes", "links", "fits", "socials",
        "Boston accent", "British accent", "Debbie Marks impression",
        "cozy corner", "manifesto", "mixtape", "magnum opus",
        "search history", "bookmarks",
        "wares", "lore", "origin story", "final form", "spaghetti code",
        "Bankai", "fireball jutsu", "power level", "stand",
        "stone world", "domain expansion", "equivalent exchange", "bizarre adventure",
        "crystal structures", "peptides", "nucleic acids"
      ];

      const el = document.getElementById("typed");
      let queue = [];
      let i = 0;

      function shuffle(arr) {
        for (let j = arr.length - 1; j > 0; j--) {
          const k = Math.floor(Math.random() * (j + 1));
          [arr[j], arr[k]] = [arr[k], arr[j]];
        }
        return arr;
      }

      function next() {
        if (queue.length === 0) queue = shuffle([...words]);
        return queue.pop();
      }

      function typeWord(word) {
        if (i <= word.length) {
          el.textContent = word.slice(0, i);
          i++;
          setTimeout(() => typeWord(word), 55);
        } else {
          setTimeout(() => deleteWord(word), 1500);
        }
      }

      function deleteWord(word) {
        if (i > 0) {
          i--;
          el.textContent = word.slice(0, i);
          setTimeout(() => deleteWord(word), 35);
        } else {
          setTimeout(() => { i = 0; typeWord(next()); }, 300);
        }
      }

      typeWord(next());
    })();

    // --- Interactive lava lamp (WebGL metaball shader) ---
    (() => {
      const canvas = document.getElementById("lava");
      const gl = canvas.getContext("webgl");
      if (!gl) { console.warn("WebGL not available — lava lamp disabled"); return; }

      let W, H;
      let mx = null, my = null;
      let mouseSpeed = 0;
      let mouseDown = false;
      let time = 0;
      let cursorRadius = 52;
      let cursorRadiusVel = 0;
      let hasPopped = false;
      let hasReassembled = false;
      let popFrame = 0;

      function resize() {
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
        gl.viewport(0, 0, W, H);
      }
      resize();
      window.addEventListener("resize", resize);

      window.addEventListener("mousemove", e => {
        if (mx !== null) {
          const dx = e.clientX - mx;
          const dy = e.clientY - my;
          mouseSpeed = Math.sqrt(dx * dx + dy * dy);
        }
        mx = e.clientX; my = e.clientY;
      });
      window.addEventListener("touchmove", e => {
        const tx = e.touches[0].clientX, ty = e.touches[0].clientY;
        if (mx !== null) {
          const dx = tx - mx, dy = ty - my;
          mouseSpeed = Math.sqrt(dx * dx + dy * dy);
        }
        mx = tx; my = ty;
      }, { passive: true });
      window.addEventListener("mouseleave", () => { mx = null; my = null; mouseSpeed = 0; mouseDown = false; });
      window.addEventListener("mousedown", () => { mouseDown = true; });
      window.addEventListener("mouseup", () => { mouseDown = false; });
      window.addEventListener("touchstart", () => { mouseDown = true; }, { passive: true });
      window.addEventListener("touchend", () => { mouseDown = false; });

      // --- Shaders ---
      const vsSource = `
        attribute vec2 a_pos;
        void main() { gl_Position = vec4(a_pos, 0.0, 1.0); }
      `;

      const fsSource = `
        precision mediump float;
        uniform float u_time;
        uniform vec3 u_blobs[9];

        float hash(vec2 p) {
          return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
        }

        void main() {
          vec2 uv = gl_FragCoord.xy;
          float field = 0.0;

          for (int i = 0; i < 9; i++) {
            vec2 delta = uv - u_blobs[i].xy;
            float r = u_blobs[i].z;
            float distSq = dot(delta, delta);
            field += (r * r) / max(distSq, 1.0);
          }

          vec3 bg = vec3(0.094, 0.094, 0.106);
          float threshold = 0.65;

          // Distance from the iso-surface
          float dist = abs(field - threshold);

          // Sharp neon edge line
          float edge = exp(-dist * 35.0);

          // Tight glow halo for good contrast against dark bg
          float glow = exp(-dist * 14.0) * 0.3;

          // Dark tinted interior (subtle)
          float interior = smoothstep(threshold - 0.02, threshold + 0.02, field);

          // Neon colors
          vec3 neonBright = vec3(0.75, 0.40, 1.0);
          vec3 neonGlow = vec3(0.50, 0.20, 0.85);
          vec3 interiorColor = vec3(0.12, 0.06, 0.22);

          vec3 col = bg;
          col = mix(col, interiorColor, interior * 0.35);
          col += neonGlow * glow;
          col += neonBright * edge * 1.5;

          // Subtle pulsing brightness on outline
          float pulseBright = 0.9 + 0.1 * sin(u_time * 2.0);
          col *= mix(1.0, pulseBright, edge);

          // Dithering
          float dither = (hash(gl_FragCoord.xy + u_time) - 0.5) / 255.0 * 2.0;
          col += dither;

          gl_FragColor = vec4(col, 1.0);
        }
      `;

      function compileShader(src, type) {
        const s = gl.createShader(type);
        gl.shaderSource(s, src);
        gl.compileShader(s);
        if (!gl.getShaderParameter(s, gl.COMPILE_STATUS)) {
          console.error(gl.getShaderInfoLog(s));
          return null;
        }
        return s;
      }

      const vs = compileShader(vsSource, gl.VERTEX_SHADER);
      const fs = compileShader(fsSource, gl.FRAGMENT_SHADER);
      const prog = gl.createProgram();
      gl.attachShader(prog, vs);
      gl.attachShader(prog, fs);
      gl.linkProgram(prog);
      if (!gl.getProgramParameter(prog, gl.LINK_STATUS)) {
        console.error(gl.getProgramInfoLog(prog));
        return;
      }
      gl.useProgram(prog);

      // Fullscreen quad
      const buf = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, buf);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 1,-1, -1,1, 1,1]), gl.STATIC_DRAW);
      const aPos = gl.getAttribLocation(prog, "a_pos");
      gl.enableVertexAttribArray(aPos);
      gl.vertexAttribPointer(aPos, 2, gl.FLOAT, false, 0, 0);

      // Uniform locations
      const uTime = gl.getUniformLocation(prog, "u_time");
      const uBlobs = [];
      for (let i = 0; i < 9; i++) {
        uBlobs.push(gl.getUniformLocation(prog, `u_blobs[${i}]`));
      }

      // --- Blob physics: 3 large + 5 medium = 8 blobs ---
      function makeBlob(rMin, rMax) {
        return {
          x: 0, y: 0, vx: 0, vy: 0,
          r: rMin + Math.random() * (rMax - rMin),
          phaseX: Math.random() * Math.PI * 2,
          phaseY: Math.random() * Math.PI * 2,
          freqX: 0.00015 + Math.random() * 0.00025,
          freqY: 0.00015 + Math.random() * 0.00025,
          buoyancy: (Math.random() - 0.5) * 0.002,
        };
      }
      const blobs = [
        ...Array.from({length: 3}, () => makeBlob(90, 128)),   // large
        ...Array.from({length: 5}, () => makeBlob(49, 83)),    // medium
      ];
      // Start blobs in a ring around center card, with slow outward drift
      {
        const cx = window.innerWidth / 2;
        const cy = window.innerHeight / 2;
        for (let i = 0; i < blobs.length; i++) {
          const angle = (i / blobs.length) * Math.PI * 2 + (Math.random() - 0.5) * 0.5;
          const dist = 80 + Math.random() * 60;
          blobs[i].x = cx + Math.cos(angle) * dist;
          blobs[i].y = cy + Math.sin(angle) * dist;
        }
      }

      const hintEl = document.getElementById("bubble-hint");
      let hintTimer = 0;
      function showHint(text) {
        clearTimeout(hintTimer);
        hintEl.textContent = text;
        hintEl.classList.add("visible");
        hintTimer = setTimeout(() => hintEl.classList.remove("visible"), 4000);
      }

      function update() {
        time++;
        // Decay mouse speed each frame
        mouseSpeed *= 0.9;

        // Pop when mouse enters the bubble cluster or on first click
        if (!hasPopped) {
          let shouldPop = false;
          if (mx !== null) {
            const dx = mx - W / 2;
            const dy = my - H / 2;
            if (Math.sqrt(dx * dx + dy * dy) < 250) shouldPop = true;
          }
          if (mouseDown) shouldPop = true;
          if (shouldPop) {
            hasPopped = true;
            popFrame = time;
            for (let i = 0; i < blobs.length; i++) {
              const b = blobs[i];
              const angle = (i / blobs.length) * Math.PI * 2 + (Math.random() - 0.5) * 1.5;
              const speed = 5 + Math.random() * 3;
              b.vx = Math.cos(angle) * speed;
              b.vy = Math.sin(angle) * speed;
            }
            showHint("oh no! you popped my bubble");
          }
        }

        // Detect blobs reassembled (wait 180 frames after pop so they spread first)
        if (hasPopped && !hasReassembled && time - popFrame > 180) {
          let cx = 0, cy = 0;
          for (let i = 0; i < blobs.length; i++) { cx += blobs[i].x; cy += blobs[i].y; }
          cx /= blobs.length; cy /= blobs.length;
          let allClose = true;
          for (let i = 0; i < blobs.length; i++) {
            const dx = blobs[i].x - cx, dy = blobs[i].y - cy;
            if (Math.sqrt(dx * dx + dy * dy) > 150) { allClose = false; break; }
          }
          if (allClose) {
            hasReassembled = true;
            showHint("aw, you put it back :)");
          }
        }

        // Spring-animate cursor metaball radius (boing on click)
        const targetRadius = mouseDown ? 90 : 52;
        const springK = 0.12;
        const springDamp = 0.55;
        cursorRadiusVel += (targetRadius - cursorRadius) * springK;
        cursorRadiusVel *= springDamp;
        cursorRadius += cursorRadiusVel;

        for (let i = 0; i < blobs.length; i++) {
          const b = blobs[i];

          // sinusoidal drift (slow, languid)
          b.vx += Math.sin(time * b.freqX + b.phaseX) * 0.0002;
          b.vy += Math.cos(time * b.freqY + b.phaseY) * 0.0002;

          // buoyancy
          b.vy += b.buoyancy;

          // blob-blob interactions
          for (let j = i + 1; j < blobs.length; j++) {
            const o = blobs[j];
            const dx = o.x - b.x;
            const dy = o.y - b.y;
            const distSq = dx * dx + dy * dy;
            const dist = Math.sqrt(distSq);
            const combinedR = b.r + o.r;

            if (dist < 1) continue;

            if (dist < combinedR * 0.5) {
              const force = 0.003 * (1 - dist / (combinedR * 0.5));
              const fx = (dx / dist) * force;
              const fy = (dy / dist) * force;
              b.vx -= fx; b.vy -= fy;
              o.vx += fx; o.vy += fy;
            } else if (dist < combinedR * 3.0) {
              const force = 0.004 * (dist - combinedR * 0.5) / (combinedR * 2.5);
              const fx = (dx / dist) * force;
              const fy = (dy / dist) * force;
              b.vx += fx; b.vy += fy;
              o.vx -= fx; o.vy -= fy;
            }
          }

          // Mouse interaction — repel on hover, suck on click
          if (mx !== null) {
            const dx = b.x - mx;
            const dy = b.y - my;
            const dist = Math.max(Math.sqrt(dx * dx + dy * dy), 50);
            if (mouseDown) {
              // Click-to-suck: strong pull toward cursor
              if (dist < 900) {
                const taper = 1.0 - dist / 900;
                const force = taper * taper * 0.7;
                b.vx -= (dx / dist) * force;
                b.vy -= (dy / dist) * force;
              }
            } else if (dist < 600) {
              const speedMult = 1.0 + mouseSpeed * 0.08;
              const invSq = 1.0 / (dist * dist);
              const taper = 1.0 - dist / 600;
              const force = invSq * 3500 * speedMult * taper;
              b.vx += (dx / dist) * force;
              b.vy += (dy / dist) * force;
            }
          }

          // wall springs — soft gooey pushback, allows smooshing into walls
          if (b.x < b.r) {
            const pen = (b.r - b.x) / b.r;
            b.vx += pen * 0.15;
            b.vx *= 0.92;
          }
          if (b.x > W - b.r) {
            const pen = (b.x - (W - b.r)) / b.r;
            b.vx -= pen * 0.15;
            b.vx *= 0.92;
          }
          if (b.y < b.r) {
            const pen = (b.r - b.y) / b.r;
            b.vy += pen * 0.15;
            b.vy *= 0.92;
          }
          if (b.y > H - b.r) {
            const pen = (b.y - (H - b.r)) / b.r;
            b.vy -= pen * 0.15;
            b.vy *= 0.92;
          }

          // damping (lower = slower, more viscous)
          b.vx *= 0.984;
          b.vy *= 0.984;

          // clamp speed
          const speed = Math.sqrt(b.vx * b.vx + b.vy * b.vy);
          if (speed > 3.5) {
            b.vx = (b.vx / speed) * 3.5;
            b.vy = (b.vy / speed) * 3.5;
          }

          b.x += b.vx;
          b.y += b.vy;

          // Allow center past edge by up to half radius (wall smoosh)
          b.x = Math.max(-b.r * 0.5, Math.min(W + b.r * 0.5, b.x));
          b.y = Math.max(-b.r * 0.5, Math.min(H + b.r * 0.5, b.y));
        }
      }

      function draw() {
        gl.uniform1f(uTime, time * 0.01);

        for (let i = 0; i < blobs.length; i++) {
          const b = blobs[i];
          gl.uniform3f(uBlobs[i], b.x, H - b.y, b.r);
        }

        // Mouse cursor metaball (index 8) — spring-animated radius
        if (mx !== null) {
          gl.uniform3f(uBlobs[8], mx, H - my, cursorRadius);
        } else {
          gl.uniform3f(uBlobs[8], 0.0, 0.0, 0.0);
        }

        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
      }

      function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
      }
      loop();
    })();
  </script>
</body>
</html>
